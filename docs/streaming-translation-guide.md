# Streaming Translation åŠŸèƒ½æŒ‡å—

> ğŸ“… å»ºç«‹æ—¥æœŸï¼š2026-02-15
> ğŸ“¦ ç›¸é—œ Commitï¼š`71904e1` (feat/streaming-translation)

---

## ç›®éŒ„

1. [ç‚ºä»€éº¼éœ€è¦ Streaming Translationï¼Ÿ](#ç‚ºä»€éº¼éœ€è¦-streaming-translation)
2. [é‹ä½œæ©Ÿåˆ¶ç¸½è¦½](#é‹ä½œæ©Ÿåˆ¶ç¸½è¦½)
3. [æ–°èˆŠç‰ˆæ¯”è¼ƒ](#æ–°èˆŠç‰ˆæ¯”è¼ƒ)
4. [æ ¸å¿ƒæŠ€è¡“è©³è§£](#æ ¸å¿ƒæŠ€è¡“è©³è§£)
5. [Context Management](#context-management)
6. [è³‡æ–™æµåœ–è§£](#è³‡æ–™æµåœ–è§£)
7. [å¸¸è¦‹å•é¡Œ](#å¸¸è¦‹å•é¡Œ)

---

## ç‚ºä»€éº¼éœ€è¦ Streaming Translationï¼Ÿ

### å•é¡Œï¼šä½¿ç”¨è€…ç­‰å¾…æ™‚é–“éé•·

åœ¨èˆŠç‰ˆçš„å¯¦ä½œä¸­ï¼Œç¿»è­¯æ˜¯ **é˜»å¡å¼ï¼ˆBlockingï¼‰** çš„ï¼š

```
ä½¿ç”¨è€…è½åˆ°ä¸€å¥è©± â†’ Deepgram è¾¨è­˜å®Œæˆ â†’ å‘¼å« Gemini API â†’ ç­‰å¾…å®Œæ•´å›æ‡‰ â†’ é¡¯ç¤ºç¿»è­¯
                                                    â†‘
                                              å¯èƒ½éœ€è¦ 1-3 ç§’
```

é€™æ®µç­‰å¾…æ™‚é–“å°å³æ™‚å­—å¹•ä¾†èªªå¤ªé•·äº†ï¼Œä½¿ç”¨è€…é«”é©—ä¸ä½³ã€‚

### è§£æ±ºæ–¹æ¡ˆï¼šStreaming API

Streaming è®“ç¿»è­¯å¯ä»¥ **é‚Šæ”¶é‚Šé¡¯ç¤º**ï¼š

```
ä½¿ç”¨è€…è½åˆ°ä¸€å¥è©± â†’ Deepgram è¾¨è­˜å®Œæˆ â†’ å‘¼å« Gemini Streaming API
                                              â†“
                              æ”¶åˆ° chunk 1 â†’ ç«‹å³é¡¯ç¤ºã€Œä½ ã€
                              æ”¶åˆ° chunk 2 â†’ æ›´æ–°ç‚ºã€Œä½ å¥½ã€
                              æ”¶åˆ° chunk 3 â†’ æ›´æ–°ç‚ºã€Œä½ å¥½å—ã€
                              æ”¶åˆ° chunk 4 â†’ æ›´æ–°ç‚ºã€Œä½ å¥½å—ï¼Ÿã€âœ… å®Œæˆ
```

ä½¿ç”¨è€…å¯ä»¥æ›´å¿«çœ‹åˆ°ç¿»è­¯é–‹å§‹ï¼Œå¿ƒç†ä¸Šæ„Ÿè¦ºæ›´ã€Œå³æ™‚ã€ã€‚

---

## é‹ä½œæ©Ÿåˆ¶ç¸½è¦½

### æ•´é«”æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Auto-Sub æ•´é«”æ¶æ§‹                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Swift      â”‚     â”‚   Python     â”‚     â”‚   Gemini     â”‚        â”‚
â”‚  â”‚   Frontend   â”‚â”€â”€â”€â”€â–¶â”‚   Backend    â”‚â”€â”€â”€â”€â–¶â”‚   API        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                    â”‚                    â”‚                 â”‚
â”‚         â”‚                    â”‚                    â”‚                 â”‚
â”‚         â–¼                    â–¼                    â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ AppState     â”‚     â”‚ translator.pyâ”‚     â”‚ Streaming    â”‚        â”‚
â”‚  â”‚ - å­—å¹•ç‹€æ…‹   â”‚â—€â”€â”€â”€â”€â”‚ - ç¿»è­¯é‚è¼¯   â”‚â—€â”€â”€â”€â”€â”‚ Response     â”‚        â”‚
â”‚  â”‚ - å³æ™‚æ›´æ–°   â”‚     â”‚ - Context    â”‚     â”‚ - Chunks     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Streaming æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ main.py â”‚      â”‚ translator  â”‚      â”‚ Gemini Streaming API  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                         â”‚
     â”‚ on_transcript()  â”‚                         â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                         â”‚
     â”‚                  â”‚                         â”‚
     â”‚                  â”‚ send_message_stream()   â”‚
     â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                  â”‚                         â”‚
     â”‚                  â”‚â—€â”€â”€ chunk 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                  â”‚    (éƒ¨åˆ† JSON)           â”‚
     â”‚                  â”‚                         â”‚
     â”‚  streaming_cb    â”‚â—€â”€â”€ chunk 2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    (æ›´å¤š JSON)          â”‚
     â”‚                  â”‚                         â”‚
     â”‚  streaming_cb    â”‚â—€â”€â”€ chunk 3 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    (å®Œæ•´ JSON)          â”‚
     â”‚                  â”‚                         â”‚
     â”‚  final result    â”‚                         â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚
     â”‚                  â”‚                         â”‚
```

---

## æ–°èˆŠç‰ˆæ¯”è¼ƒ

### å‡½æ•¸å°ç…§è¡¨

| åŠŸèƒ½ | èˆŠç‰ˆï¼ˆBlockingï¼‰ | æ–°ç‰ˆï¼ˆStreamingï¼‰ |
|------|-----------------|-------------------|
| ç¿»è­¯å‡½æ•¸ | `translate_with_context_correction()` | `translate_with_context_correction_streaming()` |
| API å‘¼å« | `send_message()` | `send_message_stream()` |
| å›æ‡‰æ–¹å¼ | ä¸€æ¬¡æ”¶åˆ°å®Œæ•´çµæœ | åˆ†æ‰¹æ”¶åˆ° chunks |
| UI æ›´æ–° | ç¿»è­¯å®Œæˆå¾Œä¸€æ¬¡æ›´æ–° | é‚Šç¿»è­¯é‚Šæ›´æ–° |
| å¤±æ•—è™•ç† | ç›´æ¥ fallback | é™ç´šç‚º blocking ç‰ˆæœ¬ |

### ç¨‹å¼ç¢¼å°æ¯”

#### èˆŠç‰ˆï¼ˆBlockingï¼‰

```python
# translator.py - èˆŠç‰ˆ
def translate_with_context_correction(
    self,
    current_text: str,
    prev_text: Optional[str] = None,
    prev_translation: Optional[str] = None
) -> Tuple[str, Optional[str]]:
    # ... æº–å‚™ prompt ...

    # ä¸€æ¬¡ç­‰å¾…å®Œæ•´å›æ‡‰
    response = self._send_message_with_timeout(prompt)

    # è§£æçµæœ
    result = json.loads(response.text.strip())
    return (result.get("current", ""), result.get("correction"))
```

```python
# main.py - èˆŠç‰ˆå‘¼å«æ–¹å¼
current_trans, prev_correction = translator.translate_with_context_correction(
    text, prev_text, prev_translation
)
# é€™è£¡æœƒç­‰å¾…å®Œæ•´ç¿»è­¯å®Œæˆ
```

#### æ–°ç‰ˆï¼ˆStreamingï¼‰

```python
# translator.py - æ–°ç‰ˆ
def translate_with_context_correction_streaming(
    self,
    current_text: str,
    prev_text: Optional[str] = None,
    prev_translation: Optional[str] = None,
    on_streaming_update=None  # æ–°å¢ï¼šå³æ™‚æ›´æ–° callback
) -> Tuple[str, Optional[str]]:
    # ... æº–å‚™ prompt ...

    # Streaming è™•ç†
    def on_chunk(chunk_text: str):
        accumulated_json += chunk_text
        # 50ms debounce
        if time.time() - last_update_time < 0.05:
            return
        # å˜—è©¦æå–éƒ¨åˆ†ç¿»è­¯
        partial = self._extract_partial_current(accumulated_json)
        if partial and on_streaming_update:
            on_streaming_update(partial, None)  # å³æ™‚é€šçŸ¥ UI

    response_text, usage_metadata = self._send_message_stream_with_timeout(
        prompt, timeout=10, on_chunk=on_chunk
    )

    # è§£ææœ€çµ‚çµæœ
    result = json.loads(response_text.strip())
    return (result.get("current", ""), result.get("correction"))
```

```python
# main.py - æ–°ç‰ˆå‘¼å«æ–¹å¼
def on_streaming(partial: str, correction):
    # å³æ™‚è¼¸å‡ºåˆ° stdoutï¼Œè®“ Swift å¯ä»¥æ›´æ–° UI
    output_streaming_update(transcript_id, partial)

current_trans, prev_correction = translator.translate_with_context_correction_streaming(
    text, prev_text, prev_translation,
    on_streaming_update=on_streaming  # æä¾› callback
)
```

### ä½¿ç”¨è€…é«”é©—æ¯”è¼ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        èˆŠç‰ˆï¼ˆBlockingï¼‰                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ™‚é–“è»¸ï¼š T+0s â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ T+2s             â”‚
â”‚                                                                 â”‚
â”‚ UI é¡¯ç¤ºï¼š                                                       â”‚
â”‚   [ç¿»è­¯ä¸­...] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [ä½ å¥½å—ï¼Ÿ]     â”‚
â”‚                                                                 â”‚
â”‚ å•é¡Œï¼šä½¿ç”¨è€…è¦ç­‰ 2 ç§’æ‰çœ‹åˆ°ä»»ä½•ç¿»è­¯çµæœ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ–°ç‰ˆï¼ˆStreamingï¼‰                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ™‚é–“è»¸ï¼š T+0s â”€â”€ T+0.3s â”€â”€ T+0.6s â”€â”€ T+0.9s â”€â”€ T+1.2s          â”‚
â”‚                                                                 â”‚
â”‚ UI é¡¯ç¤ºï¼š                                                       â”‚
â”‚   [ç¿»è­¯ä¸­...] â†’ [ä½ ] â†’ [ä½ å¥½] â†’ [ä½ å¥½å—] â†’ [ä½ å¥½å—ï¼Ÿ]           â”‚
â”‚                                                                 â”‚
â”‚ å„ªé»ï¼šä½¿ç”¨è€…æ›´å¿«çœ‹åˆ°ç¿»è­¯é–‹å§‹ï¼Œå¿ƒç†æ„Ÿè¦ºæ›´å³æ™‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒæŠ€è¡“è©³è§£

### 1. Producer-Consumer Pattern

Streaming éœ€è¦è™•ç†ä¸€å€‹é›£é¡Œï¼š**å¦‚ä½•è®“ timeout åœ¨ iterator é˜»å¡æ™‚ä¹Ÿèƒ½ç”Ÿæ•ˆï¼Ÿ**

Gemini çš„ `send_message_stream()` æœƒè¿”å›ä¸€å€‹ iteratorï¼Œå¦‚æœç¶²è·¯æ…¢ï¼Œé€™å€‹ iterator å¯èƒ½æœƒå¡ä½ã€‚æˆ‘å€‘éœ€è¦èƒ½å¤ åœ¨è¶…æ™‚å¾Œå–æ¶ˆå®ƒã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šä½¿ç”¨ Producer-Consumer æ¨¡å¼

```python
def _send_message_stream_with_timeout(self, prompt, timeout, on_chunk):
    chunk_queue = queue.Queue()
    cancel_flag = [False]
    done_flag = [False]
    exception_holder = [None]

    # Producerï¼šåœ¨èƒŒæ™¯åŸ·è¡Œç·’ä¸­è¿­ä»£ streaming response
    def producer():
        try:
            if cancel_flag[0]:
                chunk_queue.put(('cancelled', None))
                return

            response = chat_ref.send_message_stream(prompt)
            for chunk in response:
                if cancel_flag[0]:  # æª¢æŸ¥æ˜¯å¦è¢«å–æ¶ˆ
                    chunk_queue.put(('cancelled', None))
                    return
                chunk_queue.put(('chunk', chunk))
            chunk_queue.put(('done', None))
        except Exception as e:
            exception_holder[0] = e
            chunk_queue.put(('error', None))
        finally:
            done_flag[0] = True

    # å•Ÿå‹• producer åŸ·è¡Œç·’
    thread = threading.Thread(target=producer, daemon=True)
    thread.start()

    # Consumerï¼šå¾ queue å–å‡º chunks
    while True:
        if time.time() - start_time > timeout:
            cancel_flag[0] = True  # é€šçŸ¥ producer å–æ¶ˆ
            thread.join(timeout=0.5)  # ç­‰å¾…æ”¶æ–‚
            self._rebuild_session()  # é‡å»º session
            raise TimeoutError(...)

        msg_type, data = chunk_queue.get(timeout=0.1)
        # è™•ç†ä¸åŒé¡å‹çš„è¨Šæ¯...
```

**ç‚ºä»€éº¼éœ€è¦é€™éº¼è¤‡é›œï¼Ÿ**

- Python çš„ iterator ç„¡æ³•å¾å¤–éƒ¨ä¸­æ–·
- ä½¿ç”¨ queue ä½œç‚ºç·©è¡ï¼Œè®“ consumer å¯ä»¥æª¢æŸ¥ timeout
- `cancel_flag` è®“ producer çŸ¥é“è¦åœæ­¢

### 2. Debounce æ©Ÿåˆ¶

Gemini streaming å¯èƒ½æœƒéå¸¸é »ç¹åœ°ç™¼é€ chunksï¼ˆæ¯å¹¾æ¯«ç§’å°±ä¸€å€‹ï¼‰ã€‚å¦‚æœæ¯æ¬¡éƒ½æ›´æ–° UIï¼Œæœƒé€ æˆæ•ˆèƒ½å•é¡Œã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š50ms debounce

```python
DEBOUNCE_MS = 0.05  # 50ms

def on_chunk(chunk_text: str):
    accumulated_json += chunk_text

    # Debounceï¼š50ms å…§ä¸é‡è¤‡æ›´æ–°
    if time.time() - last_update_time < DEBOUNCE_MS:
        return

    partial = self._extract_partial_current(accumulated_json)
    if partial and on_streaming_update:
        on_streaming_update(partial, None)
        last_update_time = time.time()
```

### 3. Partial JSON è§£æ

Streaming éç¨‹ä¸­ï¼Œæˆ‘å€‘æ”¶åˆ°çš„æ˜¯ **ä¸å®Œæ•´çš„ JSON**ï¼š

```json
{"current": "ä½ å¥½å—ï¼Ÿ", "correction": null}  // å®Œæ•´
{"current": "ä½ å¥½å—                          // ä¸å®Œæ•´
{"current":                                 // æ›´ä¸å®Œæ•´
```

**è§£æ±ºæ–¹æ¡ˆ**ï¼šä½¿ç”¨æ­£å‰‡è¡¨é”å¼æå–éƒ¨åˆ†å…§å®¹

```python
def _extract_partial_current(self, accumulated_json: str) -> Optional[str]:
    # å…ˆå˜—è©¦è§£æå®Œæ•´ JSON
    try:
        result = json.loads(accumulated_json.strip())
        return result.get("current", "")
    except json.JSONDecodeError:
        pass

    # ç”¨æ­£å‰‡æå– current æ¬„ä½
    # åŒ¹é… "current": "..." (å¯èƒ½ä¸å®Œæ•´)
    match = re.search(r'"current"\s*:\s*"((?:[^"\\]|\\.)*)', accumulated_json)
    if match:
        partial_value = match.group(1)
        # è™•ç†è½‰ç¾©å­—å…ƒ
        try:
            partial_value = json.loads(f'"{partial_value}"')
        except json.JSONDecodeError:
            pass
        return partial_value

    return None
```

### 4. Swift ç«¯çš„ Monotonic Growth Check

å› ç‚ºç¶²è·¯å»¶é²ï¼Œå¯èƒ½æœƒæœ‰ **èˆŠçš„ partial è¦†è“‹æ–°çš„** å•é¡Œã€‚Swift ç«¯ä½¿ç”¨ã€Œåªæ¥å—æ›´é•·çš„ã€ç­–ç•¥ï¼š

```swift
// AppState.swift
func updateStreamingTranslation(id: UUID, partial: String) {
    if let index = subtitleHistory.firstIndex(where: { $0.id == id }) {
        let existingLength = subtitleHistory[index].translatedText?.count ?? 0
        // åªæ¥å—æ›´é•·çš„ partial
        guard partial.count > existingLength else {
            return
        }
        // æ›´æ–°...
    }
}
```

---

## Context Management

Context Management åœ¨æ–°èˆŠç‰ˆä¸­ **å®Œå…¨ç›¸åŒ**ï¼Œå› ç‚ºå®ƒæ˜¯åœ¨ç¿»è­¯å®Œæˆå¾Œæ‰è™•ç†çš„ã€‚

### Compaction æ©Ÿåˆ¶

ç•¶ Gemini Chat Session çš„ token ç´¯ç©è¶…é `max_context_tokens`ï¼ˆé è¨­ 20,000ï¼‰æ™‚ï¼Œæœƒè§¸ç™¼ **Compactionï¼ˆå£“ç¸®ï¼‰**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Context Compaction æµç¨‹                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. åµæ¸¬ token è¶…éé–¾å€¼ (20K)                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     â”‚ Token count: 20,500 > 20,000 (limit)  â”‚                  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                         â”‚                                       â”‚
â”‚                         â–¼                                       â”‚
â”‚  2. æ‘˜è¦æ­·å²è¨˜éŒ„                                                 â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     â”‚ å‘¼å« generate_content() è«‹æ±‚æ‘˜è¦       â”‚                  â”‚
â”‚     â”‚ è¼¸å…¥ï¼šæ•´å€‹ chat history                â”‚                  â”‚
â”‚     â”‚ è¼¸å‡ºï¼šäººåå°ç…§è¡¨ + ä¸»é¡Œæ‘˜è¦            â”‚                  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                         â”‚                                       â”‚
â”‚                         â–¼                                       â”‚
â”‚  3. é‡å»º Session                                                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     â”‚ å»ºç«‹æ–°çš„ chat session                  â”‚                  â”‚
â”‚     â”‚ token count é‡ç½®ç‚º 0                   â”‚                  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                         â”‚                                       â”‚
â”‚                         â–¼                                       â”‚
â”‚  4. æ³¨å…¥æ‘˜è¦                                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     â”‚ å°‡æ‘˜è¦ä½œç‚ºç¬¬ä¸€å‰‡è¨Šæ¯ç™¼é€çµ¦æ–° session   â”‚                  â”‚
â”‚     â”‚ ç¢ºä¿ç¿»è­¯ä¸€è‡´æ€§å¾—ä»¥å»¶çºŒ                 â”‚                  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¨‹å¼ç¢¼å¯¦ä½œ

```python
# translator.py
def _summarize_and_rebuild(self) -> None:
    # Step 1: å–å¾— chat history
    history = self._chat.get_history()

    # Step 2: å»ºç«‹æ‘˜è¦è«‹æ±‚
    summary_contents = list(history) + [
        types.Content(
            role="user",
            parts=[types.Part.from_text(text=self._summarize_prompt)]
        )
    ]

    # Step 3: å‘¼å« generate_contentï¼ˆä¸ç”¨ chatï¼Œé¿å…å¢åŠ  tokenï¼‰
    summary_response = self._generate_content_with_timeout(
        contents=summary_contents,
        config=self._plain_config,  # ä¸ç”¨ JSON mode
        timeout=20,
    )
    self._context_summary = summary_response.text.strip()

    # Step 4: é‡å»º session
    self._chat = self.client.chats.create(
        model=self.model,
        config=self._config,
    )
    self._total_tokens = 0

    # Step 5: æ³¨å…¥æ‘˜è¦
    if self._context_summary:
        handover_msg = CONTEXT_HANDOVER_TEMPLATE.format(
            summary=self._context_summary
        )
        self._send_message_with_timeout(handover_msg)
```

### ç‚ºä»€éº¼éœ€è¦ Compactionï¼Ÿ

1. **æˆæœ¬è€ƒé‡**ï¼šGemini API æŒ‰ token è¨ˆè²»ï¼Œcontext è¶Šå¤§è¶Šè²´
2. **å“è³ªè€ƒé‡**ï¼šéé•·çš„ context å¯èƒ½å°è‡´æ¨¡å‹ã€Œå¿˜è¨˜ã€æ—©æœŸçš„è¨­å®š
3. **ä¸€è‡´æ€§ç¶­è­·**ï¼šé€éæ‘˜è¦ä¿ç•™é—œéµè³‡è¨Šï¼ˆäººåå°ç…§ã€ä¸»é¡ŒèƒŒæ™¯ï¼‰

### Chat Session vs ç„¡ç‹€æ…‹è«‹æ±‚

| ç‰¹æ€§ | Chat Session | ç„¡ç‹€æ…‹è«‹æ±‚ |
|------|-------------|-----------|
| ä¸Šä¸‹æ–‡ä¿ç•™ | âœ… è‡ªå‹•ç´¯ç© | âŒ æ¯æ¬¡é‡æ–°å‚³é€ |
| Token æˆæœ¬ | éš¨æ™‚é–“å¢åŠ  | å›ºå®š |
| ç¿»è­¯ä¸€è‡´æ€§ | âœ… é«˜ï¼ˆæ¨¡å‹è¨˜å¾—å‰æ–‡ï¼‰ | âŒ ä½ |
| éœ€è¦ Compaction | âœ… æ˜¯ | âŒ å¦ |

---

## è³‡æ–™æµåœ–è§£

### å®Œæ•´çš„ IPC é€šè¨Šæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              IPC é€šè¨Šæµç¨‹                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Swift (PythonBridgeService)          Python (main.py)                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚                                                                         â”‚
â”‚  1. éŸ³è¨Šè³‡æ–™                                                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚     â”‚ stdin: PCM audio (9600 bytes/chunk)         â”‚                    â”‚
â”‚     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚                    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                         â”‚
â”‚  2. Deepgram è¾¨è­˜çµæœ                                                 â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚     â”‚ stdout: {"type":"transcript","id":"..."}    â”‚                    â”‚
â”‚     â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                         â”‚
â”‚  3. Streaming æ›´æ–° (æ–°å¢)                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚     â”‚ stdout: {"type":"translation_streaming",    â”‚                    â”‚
â”‚     â”‚         "id":"...","partial":"ä½ å¥½å—"}       â”‚                    â”‚
â”‚     â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                    â”‚
â”‚     â”‚ (å¯èƒ½å¤šæ¬¡)                                   â”‚                    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                         â”‚
â”‚  4. æœ€çµ‚ç¿»è­¯çµæœ                                                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚     â”‚ stdout: {"type":"subtitle","id":"...",      â”‚                    â”‚
â”‚     â”‚         "original":"...","translation":"..."}                    â”‚
â”‚     â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                         â”‚
â”‚  5. å‰å¥ä¿®æ­£ (å¯é¸)                                                   â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚     â”‚ stdout: {"type":"translation_update",       â”‚                    â”‚
â”‚     â”‚         "id":"prev-id","translation":"..."} â”‚                    â”‚
â”‚     â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### JSON è¨Šæ¯é¡å‹ç¸½è¦½

| é¡å‹ | æ–¹å‘ | ç”¨é€” |
|------|------|------|
| `transcript` | Python â†’ Swift | åŸæ–‡è¾¨è­˜å®Œæˆï¼Œé–‹å§‹ç¿»è­¯ |
| `translation_streaming` | Python â†’ Swift | å³æ™‚ç¿»è­¯æ›´æ–°ï¼ˆStreamingï¼‰ |
| `subtitle` | Python â†’ Swift | æœ€çµ‚ç¿»è­¯çµæœ |
| `translation_update` | Python â†’ Swift | å‰å¥ç¿»è­¯ä¿®æ­£ |
| `interim` | Python â†’ Swift | æ­£åœ¨èªªçš„è©±ï¼ˆDeepgram interimï¼‰ |
| `status` | Python â†’ Swift | é€£ç·šç‹€æ…‹ |
| `error` | Python â†’ Swift | éŒ¯èª¤è¨Šæ¯ |

---

## å¸¸è¦‹å•é¡Œ

### Q1: Streaming æœƒå¢åŠ  API æˆæœ¬å—ï¼Ÿ

**ä¸æœƒ**ã€‚Streaming å’Œ Blocking ä½¿ç”¨ç›¸åŒçš„ APIï¼Œæˆæœ¬å–æ±ºæ–¼ token æ•¸é‡ï¼Œèˆ‡å›æ‡‰æ–¹å¼ç„¡é—œã€‚

### Q2: å¦‚æœ Streaming å¤±æ•—æ€éº¼è¾¦ï¼Ÿ

æœƒè‡ªå‹•é™ç´šç‚º Blocking ç‰ˆæœ¬ï¼š

```python
try:
    # å˜—è©¦ streaming
    return self.translate_with_context_correction_streaming(...)
except Exception as e:
    print(f"Streaming failed: {e}, falling back to blocking...")
    # é™ç´šç‚º blocking
    return self.translate_with_context_correction(...)
```

### Q3: ç‚ºä»€éº¼ Context Management åœ¨æ–°èˆŠç‰ˆç›¸åŒï¼Ÿ

å› ç‚º Context Management æ˜¯åœ¨ **ç¿»è­¯å®Œæˆå¾Œ** æ‰æª¢æŸ¥å’Œè™•ç†çš„ï¼Œèˆ‡ç¿»è­¯éç¨‹æ˜¯ blocking æˆ– streaming ç„¡é—œã€‚

### Q4: Partial JSON è§£æå¯èƒ½æœƒå‡ºéŒ¯å—ï¼Ÿ

æœ‰å¯èƒ½ï¼Œä½†å•é¡Œä¸å¤§ï¼š
- å¦‚æœè§£æå¤±æ•—ï¼Œå°±è·³éé€™æ¬¡æ›´æ–°
- æœ€çµ‚å®Œæ•´çš„ JSON ä¸€å®šæœƒæ­£ç¢ºè§£æ
- ä½¿ç”¨è€…åªæœƒå°‘çœ‹åˆ°å¹¾æ¬¡ä¸­é–“æ›´æ–°

### Q5: ç‚ºä»€éº¼è¦é™åˆ¶ streaming æ›´æ–°çš„é »ç‡ï¼ˆdebounceï¼‰ï¼Ÿ

1. **UI æ•ˆèƒ½**ï¼šéæ–¼é »ç¹çš„æ›´æ–°æœƒé€ æˆ UI é–ƒçˆ
2. **IPC è² è¼‰**ï¼šæ¯æ¬¡æ›´æ–°éƒ½è¦é€šé stdin/stdoutï¼Œéæ–¼é »ç¹æœƒå¢åŠ è² æ“”
3. **ä½¿ç”¨è€…é«”é©—**ï¼šäººçœ¼ç„¡æ³•è¿½è¹¤æ¯«ç§’ç´šçš„è®ŠåŒ–

### Q6: Compaction æœƒå½±éŸ¿ç¿»è­¯å“è³ªå—ï¼Ÿ

**å½±éŸ¿å¾ˆå°**ã€‚æ‘˜è¦ä¿ç•™äº†é—œéµè³‡è¨Šï¼ˆäººåå°ç…§ã€ä¸»é¡ŒèƒŒæ™¯ï¼‰ï¼Œæ–°çš„ session ä»ç„¶èƒ½ä¿æŒç¿»è­¯ä¸€è‡´æ€§ã€‚

---

## ç¸½çµ

| ç‰¹æ€§ | èˆŠç‰ˆ | æ–°ç‰ˆ |
|------|------|------|
| ç¿»è­¯æ–¹å¼ | Blocking | Streaming |
| ä½¿ç”¨è€…é«”é©— | ç­‰å¾…æ™‚é–“é•· | å³æ™‚çœ‹åˆ°ç¿»è­¯ç”Ÿæˆ |
| ç¨‹å¼ç¢¼è¤‡é›œåº¦ | ç°¡å–® | è¼ƒè¤‡é›œï¼ˆProducer-Consumerã€Debounceï¼‰ |
| å¤±æ•—è™•ç† | ç›´æ¥ fallback | å…ˆå˜—è©¦ streamingï¼Œå† fallback |
| Context Management | ç›¸åŒ | ç›¸åŒ |

**é—œéµæ”¹é€²**ï¼šä½¿ç”¨è€…åœ¨ç¿»è­¯é–‹å§‹å¾Œå°±èƒ½ç«‹å³çœ‹åˆ°éƒ¨åˆ†çµæœï¼Œå¿ƒç†æ„Ÿè¦ºæ›´ã€Œå³æ™‚ã€ã€‚

---

## åƒè€ƒæ–‡ä»¶

- [Gemini API Streaming Documentation](https://ai.google.dev/gemini-api/docs/text-generation?lang=python#streaming)
- `AutoSub/AutoSub/Resources/backend/translator.py` - ç¿»è­¯å™¨å¯¦ä½œ
- `AutoSub/AutoSub/Resources/backend/main.py` - IPC è™•ç†
- `AutoSub/AutoSub/Services/PythonBridgeService.swift` - Swift ç«¯é€šè¨Š
- `AutoSub/AutoSub/Models/AppState.swift` - ç‹€æ…‹ç®¡ç†
